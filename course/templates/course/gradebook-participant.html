{% extends "course/course-base.html" %}
{% load i18n %}

{% load static %}

{% block title %}
  {% trans "My Grades" %} - {% trans "RELATE" %}
{% endblock %}

{% block header_extra %}
  {% include "datatables-header.html" %}
{% endblock %}

{% block content %}
  {% if grade_participation.pk == participation.pk %}
    <h1>{% trans "My Grades" %}</h1>
  {% else %}
    <h1>{% trans "Grades" %}</h1>

    <table class="table table-condensed">
      <thead>
        <th>{% trans "Property" %}</th><th>{% trans "Value" %}</th>
      </thead>
      <tbody>
      <tr>
        <td>{% trans "User ID" %}</td>
        <td><span class="sensitive">{{ grade_participation.user.username }}</span></td>
      </tr>
      <tr>
        <td>{% trans "Name" context "real name of a user" %}</td>
        <td>
          <span class="sensitive">
                {{ grade_participation.user.get_full_name }}
          </span>
        </td>
      </tr>
      <tr>
        <td>{% trans "Tags" %}</td>
        <td>
          {% for ptag in grade_participation.tags.all %}
            {% if is_privileged_view or ptag.shown_to_participant %}
              <span class="label label-default">{{ ptag.name }}</span>
            {% endif %}
          {% endfor %}
        </td>
      </tr>
    </table>
  {% endif %}

  <table class="table table-striped gradebook-single">
    <thead>
      <th>{% trans "Name of grading opportunity" %}</th>
      <th class="hidden">{% trans "Creation Time" %}</th>
      <th>{% trans "Grade" %}</th>
      <th>{% trans "Graded Time" %}</th>
    </thead>
    <tbody>
      {% for grade_info, idx in grade_table %}
      {% with grade_info.grade_state_machine as gsm %}
      <tr>
        <td data-order="{{ grade_info.opportunity.identifier }}">{{ grade_info.opportunity.name }}</td>
        <td class="hidden" data-order="{{ grade_info.opportunity.creation_time.isoformat }}">{{ grade_info.opportunity.creation_time|date:'Y/M' }}</td>
        {% if grade_info.opportunity.result_shown_in_participant_grade_book %}
          <td data-order="{{ gsm.stringify_percentage }}">
            <a href="{% url "relate-view_single_grade" course.identifier grade_participation.id grade_info.opportunity.id %}"
             ><span class="sensitive">{{ gsm.stringify_state }}</span></a>
          </td>
          <td
           {% if  gsm.last_graded_time %}
               data-order="{{ gsm.last_graded_time.isoformat }}"
            {% else %}
               data-order=""
            {% endif %}
            >
            {{ grade_info.grade_state_machine.last_graded_time|compact_datetime }}
          </td>
        {% else %}
          <td>{% trans "(not released)" %}</td>
          <td>{% trans "(not released)" %}</td>
        {% endif %}
      </tr>
      {% endwith %}
      {% endfor %}
    </tbody>
  </table>

  {% load coursetags %}
  {% get_current_js_lang_name as LANG %}
  <script type="text/javascript">
    var tbl = $("table.gradebook-single").dataTable({
        "scrollCollapse": true,
        "paging": false,
        "order": [[ 1, 'asc' ]],
        "columnDefs": [{ type: 'name', targets: 1 }],
        "language": {url: '{% static "datatables-i18n/i18n/" %}{{LANG}}.json'},
    } );
  </script>

{% endblock %}


