{% extends "course/course-base.html" %}
{% load i18n %}

{% load static %}

{% block title %}
  {{ course.number}}
  {% trans "Calendar" %} - {% trans "RELATE" %}
{% endblock %}

{%block header_extra %}
  <link rel='stylesheet' href='{% static "fullcalendar/dist/fullcalendar.css" %}' />
  <script src='{% static "moment/moment.js" %}'></script>
  <script src='{% static "fullcalendar/dist/fullcalendar.js" %}'></script>
  {# load calendar with local language #}
  {% get_current_language as LANGUAGE_CODE %}
  <script src='{% static "fullcalendar/dist/lang/" %}{{ LANGUAGE_CODE }}.js'></script>
  
  <script type="text/javascript" src='{%static "eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js" %}'></script>

  <link rel="stylesheet" href='{% static "eonasdan-bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.min.css" %}' />

{% endblock %}





{% block content %}

{% blocktrans trimmed %}
  <b>Note:</b> Different from the students' calendar, this calender shows all events.
{% endblocktrans %}




  <div class="row">
    <div class="col-sm-1 nopadding" style="padding:0; margin:0">
      <button id="create" type="button" class="btn btn-danger btn-md" style="width: 2.5cm;" data-toggle="modal" data-target="#editModal" onclick="remove_event_id_field();">Create</button>
    </div>

    <div class="col-sm-11">
      <div id="coursecal"></div>
    </div>
    
  </div>

  <script type="text/javascript">
    $(document).ready(function() {
        $('#coursecal').fullCalendar({
          header: {
            left: 'prev,next today',
            center: 'title',
            right: 'month,agendaWeek,agendaDay'
          },
          defaultDate: '{{ default_date }}',
          timezone: "local",

          events: {{ events_json|safe }},

          eventRender: function(event, element) {
            
            element.find('.fc-title').append( '<span class="glyphicon glyphicon-remove-circle" style="float:right;cursor:pointer" id="remove"></span>');

            element.find('.fc-title').append( '<span class="glyphicon glyphicon-pencil" style="float:right; cursor:pointer" id="edit"></span>');

            element.find("#edit").click(function() {
              edit_existing_event(event.id);
            })

            element.find("#remove").click(function() {
              delete_existing_event(event.id);
            })
          }
        });

        {% if edit_existing_event_flag %}
          $('#editModal').modal('show');
        {% endif %}  

    });
  </script>


{% blocktrans trimmed %}
  <b>Note:</b> Some calendar entries are clickable and link to entries
  below.
{% endblocktrans %}

  <div style="margin-top:3ex">
  {% for event_info in event_info_list %}
    <div id="event-{{ event_info.id }}" class="panel panel-default relate-calendar-event">
      <div class="panel-heading">
        <b>{{ event_info.human_title }}</b>
        ({{ event_info.start_time }}{% if event_info.end_time %} - {{ event_info.end_time }}{% endif %})
      </div>
      <div class="panel-body">
        {{ event_info.description|safe }}
      </div>
    </div>
  {% endfor%}
  </div>

  <div id="editModal" class="modal fade" role="dialog">
    <div class="modal-dialog"  style="width:800px">
      <form method="POST" class="form-horizontal">

        <div class="modal-content">
          <div class="modal-body">
            <br>
            
              {% load i18n %}
              {% load crispy_forms_tags %}
                {% if form_description %}
                  <h1>{{ form_description }}</h1>
                {% endif %}
                {{ form_text|safe }}
                {% if form %}
                    {% crispy form %}
                {% endif %}
                {% if forms %}
                  {% for sub_form in forms %}
                    <div class="well">
                      {% crispy sub_form %}
                    </div>
                  {% endfor %}
                {% endif %}

                {% if edit_existing_event_flag %}
                  <input type="hidden" name="existing_event_to_save" id="existing_event_to_save" value='{{id_to_edit}}' readonly>
                {% endif %}

          </div>

          <div class="modal-footer">
            <button class="btn btn-md btn-default" data-dismiss="modal" type="button">Cancel</button>
            <button class="btn btn-md btn-success" type="submit">Save</button>
          </div>
        </form>
      </div>
    </div>
  <script>
    
    $(function () {
        $('#start_time').datetimepicker({"format": "YYYY-MM-DD HH:mm", "sideBySide": true});
        $('#end_time').datetimepicker({"format": "YYYY-MM-DD HH:mm", "sideBySide": true});
    });

    function edit_existing_event(event_id) {
      $('#id_to_edit').val(event_id);
      document.existing_event_edit_form.submit();
    }

    function delete_existing_event(event_id) {
      $('#id_to_delete').val(event_id);
      document.existing_event_delete_form.submit();
    }

    function remove_event_id_field() {
      $('#existing_event_to_save').remove()
    }
  </script>

  <form method='post' name='existing_event_edit_form'>
    {% csrf_token %}
    <input type='Hidden' name='id_to_edit' id="id_to_edit" value=''>  
  </form>

  <form method='post' name='existing_event_delete_form'>
    {% csrf_token %}
    <input type='Hidden' name='id_to_delete' id="id_to_delete" value=''>  
  </form>






{% endblock %}

