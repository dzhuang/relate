function isUndefined(e){return"undefined"==typeof e}function crop_success_msg(e){$("#CropResult").addClass("alert alert-success").html(e),window.setTimeout(function(){$("#CropResult").removeClass("alert alert-error").removeClass("alert alert-success").html("")},3e3)}function crop_failed_msg(e){$("#CropResult").addClass("alert alert-error").html(e),window.setTimeout(function(){$("#CropResult").removeClass("alert alert-error").removeClass("alert alert-success").html("")},3e3)}function rotatedegree(e){var t=cropper.getContainerData();cropper.setCropBoxData({width:2,height:2,top:t.height/2-1,left:t.width/2-1}),cropper.rotate(e);var a=cropper.getCanvasData(),i=a.width*(t.height/a.height);if(i>=t.width)var o=a.height*(t.width/a.width),r={height:o,width:t.width,top:(t.height-o)/2,left:0};else var r={height:t.height,width:i,top:0,left:(t.width-i)/2};cropper.setCanvasData(r),cropper.setCropBoxData(r),$("#imageCropSubmit").removeClass("disabled"),$("#imageCropReset").removeClass("disabled")}function formatFileSize(e){return"number"!=typeof e?"":e>=1e9?(e/1e9).toFixed(2)+" GB":e>=1e6?(e/1e6).toFixed(2)+" MB":(e/1e3).toFixed(2)+" KB"}$("#past-submission_dropdown").addClass("hidden"),$(document).ready(function(){$(".relate-save-button").each(function(){$(this).attr("formaction",window.location.pathname)})});var clicked_row;$("#fileupload").on("click",".btn-edit-image",function(){clicked_row=$(event.target).closest("tr")});var cropper;$("body").on("loaded.bs.modal",function(){$(".img-container img").css("max-height",.8*$(window).height());var e=document.getElementById("dataX"),t=document.getElementById("dataY"),a=document.getElementById("dataHeight"),i=document.getElementById("dataWidth"),o=document.getElementById("dataRotate"),r={checkOrientation:!1,autoCrop:!0,autoCropArea:1,strict:!0,built:function(){},cropstart:function(e){$("#imageCropSubmit").removeClass("disabled"),$("#imageCropReset").removeClass("disabled")},crop:function(r){e.value=Math.round(r.x),t.value=Math.round(r.y),a.value=Math.round(r.height),i.value=Math.round(r.width),o.value=isUndefined(r.rotate)?"":r.rotate}},d=document.getElementById("image");cropper=new Cropper(d,r),$(".modal .modal-body").css("overflow-y","auto").css("max-height",.9*$(window).height()).css("margin",0).css("border",0),$("#rotate_right").click(function(){rotatedegree(90)}),$("#rotate_left").click(function(){rotatedegree(-90)}),$("#rotate_mright").click(function(){rotatedegree(.5)}),$("#rotate_mleft").click(function(){rotatedegree(-.5)}),$("#cropper_preview").click(function(){var e=$(".cropper-container").hasClass("hidden");if(e)$(".cropper-container").removeClass("hidden"),$("#preview").addClass("hidden").html(""),$(this).html("<i class='fa fa-eye'></i> <span>"+gettext("Preview")+"</span>"),$("button[id^='rotate_']").removeClass("hidden"),$("#imageCropReset").removeClass("hidden");else{var t=cropper.getCroppedCanvas();$(".cropper-container").addClass("hidden"),$("#preview").removeClass("hidden").html(t),$(this).html("<i class='fa fa-pencil'></i> <span>"+gettext("Edit")+"</span>"),$("button[id^='rotate_']").addClass("hidden"),$("#imageCropReset").addClass("hidden")}}),$("#imageCropSubmit").click(function(){if($(this).addClass("disabled"),$(".modal-footer > button").addClass("disabled"),x=$("#dataX").val(),y=$("#dataY").val(),width=$("#dataWidth").val(),height=$("#dataHeight").val(),rotate=$("#dataRotate").val(),""===x||""===y||""===width||""===height||""==rotate)return $(this).removeClass("disabled"),!1;$.ajax({method:"POST",url:$("#imageCropForm").attr("action"),data:$("#imageCropForm").serialize()}).done(function(e){$("#thumbnail"+e.file.pk).prop("src",e.file.thumbnailUrl),$("#previewid"+e.file.pk).prop("href",e.file.url),$("#filename"+e.file.pk).prop("href",e.file.url),$("#filetime"+e.file.pk).prop("title",e.file.timestr_title).html(e.timestr_short),$("#filesize"+e.file.pk).html(formatFileSize(e.file.size)),crop_success_msg(gettext("Done!")),setTimeout(function(){$("#modal").modal("hide")},2e3)}).fail(function(){crop_failed_msg(gettext("Failed!"))});return!1}),$("#imageCropReset").click(function(){cropper.reset(),$("#imageCropSubmit").addClass("disabled"),$("#imageCropReset").addClass("disabled")})}).on("hidden.bs.modal",".modal",function(){$(".img-container").html(""),$(this).removeData("bs.modal"),cropper.destroy()});