var inputChanged=!1;function getWidthQueryMatch_md_sm_xs(){return window.matchMedia("(max-width: 1023px)").matches}$("#blueimp-gallery").on("open",function(a){getWidthQueryMatch_md_sm_xs()&&window.history.pushState("forward",null,"#slides")}).on("close",function(a){"#slides"==location.hash&&getWidthQueryMatch_md_sm_xs()&&window.history.back()});$(window).on("popstate",function(a){null!==a.state&&getWidthQueryMatch_md_sm_xs()&&((a=$("#blueimp-gallery").data("gallery"))?a.close():$(".modal").modal("hide"))});
var hasInProgress=!1,modalIsInProgress=!1,$fileupload=$("#fileupload"),isInOperation=!1;function disable_submit_button(a){$(".relate-save-button").prop("disabled",a)}function getStatusChanged(a,b){return a?JSON.stringify(a)!==JSON.stringify(b):!1}
$fileupload.on("fileuploaddestroyed fileuploadcompleted fileuploadsortablestop",function(a,b){var c=($(this).data("blueimp-fileupload")||$(this).data("fileupload")).options.getStatus(),d=$(this).data.initialStatus;inputChanged=getStatusChanged(d,c)}).on("fileuploadadded",function(a,b){hasInProgress=!0;disable_submit_button(hasInProgress||isInOperation||modalIsInProgress)}).on("fileuploadcompleted fileuploadfailed fileuploaddestroyed",function(a,b){hasInProgress=0<($(this).data("blueimp-fileupload")||
$(this).data("fileupload")).options.filesContainer.children().find(".processing").length;disable_submit_button(hasInProgress||isInOperation||modalIsInProgress)}).on("fileuploadmodalinprogessstatus",function(a,b){modalIsInProgress=!0===b}).on("fileuploadadd fileuploaddestroy fileuploadsortablestart fileuploadmodalshownevent",function(){isInOperation=!0;disable_submit_button(hasInProgress||isInOperation||modalIsInProgress)}).on("fileuploadadded fileuploaddestroyed fileuploadfailed fileuploadcompleted fileuploadsortablestop fileuploadmodalhiddenevent",
function(){isInOperation=!1;disable_submit_button(hasInProgress||isInOperation||modalIsInProgress)}).on("fileuploadmodalshowevent",function(){getWidthQueryMatch_md_sm_xs()&&window.history.pushState("forward",null,"#edit")}).on("fileuploadmodalhideevent",function(){"#edit"===location.hash&&getWidthQueryMatch_md_sm_xs()&&window.history.back()});
function activate_change_listening(){inputChanged=!1;$(window).on("beforeunload",function(){if(inputChanged||hasInProgress||modalIsInProgress)return gettext("You have unsaved changes on this page.")});$(".relate-interaction-container form").on("submit",function(a){inputChanged=!1;$(".relate-save-button").each(function(){var a=$(this).clone();$(a).attr("disabled","1");$(this).after(a);$(this).hide()})})}
$(document).ready(function(){function a(a){var b=[];$(a).fileupload("option","filesContainer").children(".template-download").not(".processing").each(function(){b.push($(this).data($(a).fileupload("option","statusDataName")))});return b}$(".relate-save-button").each(function(){$(this).attr("formaction",window.location.pathname).detach().appendTo("#actual-submit-div")}).on("click",function(){$("#div_id_hidden_answer").html('<div class="controls"/>').find("div").html('<input type="hidden" id="id_hidden_answer" name="hidden_answer" type="text"/>').find("input").prop("value",
a($("#fileupload")))})});