{% load i18n %}

{% block CSS %}

    {% block CSS_BOOTSTRAP %}
        {# Bootstrap CSS Toolkit styles #}
        <link rel="stylesheet" href="{{ STATIC_URL }}bootstrap/dist/css/bootstrap.min.css">
    {% endblock %}

    {% block CSS_BLUEIMP_GALLERY %}
        {# Blueimp Gallery styles #}
        <link rel="stylesheet" href="{{ STATIC_URL }}blueimp-gallery/css/blueimp-gallery.min.css">
    {% endblock %}

    {% block CSS_JQUERY_FILE_UPLOAD %}
        {# CSS to style the file input field as button and adjust the Bootstrap progress bars #}
        <link rel="stylesheet" href="{{ STATIC_URL }}blueimp-file-upload/css/jquery.fileupload.css">
    {% endblock %}

    {% block CSS_JQUERY_FILE_UPLOAD_UI %}
        {# CSS to style the file input field as button and adjust the Bootstrap progress bars #}
        <link rel="stylesheet" href="{{ STATIC_URL }}blueimp-file-upload/css/jquery.fileupload-ui.css">

        {# CSS adjustments for browsers with JavaScript disabled #}
        <noscript><link rel="stylesheet" href="{{ STATIC_URL }}blueimp-file-upload/css/jquery.fileupload-noscript.css"></noscript>
        <noscript><link rel="stylesheet" href="{{ STATIC_URL }}blueimp-file-upload/css/jquery.fileupload-ui-noscript.css"> </noscript>
    {% endblock %}

    {% block CSS_HTML5_SHIM %}
        {# Shim to make HTML5 elements usable in older Internet Explorer versions #}

        <!--[if lt IE 9]>
        <script src="{{ STATIC_URL }}html5shiv/dist/html5shiv.min.js">
        </script>
        <![endif]-->
    {% endblock %}

    {% block CSS_EXTRA %}{% endblock %}

{% endblock %}

{% block UPLOAD_FORM %}
    {# The file upload form used as target for the file upload widget #}
    <form id="fileupload" action="{{ upload_handler_url }}" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        {% include "upload-form.html" %}
    </form>
{% endblock %}{# //UPLOAD_FORM #}

{% block MODAL_GALLERY %}
    <div id="blueimp-gallery" class="blueimp-gallery blueimp-gallery-controls" data-filter=":even">
        <div class="slides"></div>
        <h3 class="title"></h3>
        <a class="prev">‹</a>
        <a class="next">›</a>
        <a class="close">×</a>
        <a class="play-pause"></a>
        <ol class="indicator"></ol>
    </div>
{% endblock %}{# //MODAL_GALLERY #}

{% block JS_SCRIPTS %}
    {% block JS_JQUERY %}
        {# jQuery #}
        <script src="{{ STATIC_URL }}jquery/dist/jquery.min.js"></script>
    {% endblock %}

    {% block JS_JQUERY_UI_WIDGET %}
        {# The jQuery UI widget factory, can be omitted if jQuery UI is already included #}
        <script src="{{ STATIC_URL }}blueimp-file-upload/js/vendor/jquery.ui.widget.js"></script>
    {% endblock %}

    {% block JS_TEMPLATES_PLUGIN %}
        {# The Templates plugin is included to render the upload/download listings #}
        <script src="{{ STATIC_URL }}blueimp-tmpl/js/tmpl.min.js"></script>
    {% endblock %}

    {% block JS_LOAD_IMAGE %}
        {# The Load Image plugin is included for the preview images and image resizing functionality #}
        <script src="{{ STATIC_URL }}blueimp-load-image/js/load-image.all.min.js"></script>
    {% endblock %}

    {% block JS_CANVAS_TO_BLOB %}
        {# The Canvas to Blob plugin is included for image resizing functionality #}
        <script src="{{ STATIC_URL }}blueimp-canvas-to-blob/js/canvas-to-blob.min.js"></script>
    {% endblock %}

    {% block JS_BOOTSTRAP %}
        <script src="{{ STATIC_URL }}bootstrap/dist/js/bootstrap.min.js"></script>
    {% endblock %}

    {% block JS_BLUEIMP_GALLERY %}
        <script src="{{ STATIC_URL }}blueimp-gallery/js/jquery.blueimp-gallery.min.js"></script>
    {% endblock %}

    {% block JS_BOOTSTRAP_IFRAME_TRANSPORT %}
        {# The Iframe Transport is required for browsers without support for XHR file uploads #}
        <script src="{{ STATIC_URL }}blueimp-file-upload/js/jquery.iframe-transport.js"></script>
    {% endblock %}

    {% block JS_JQUERY_FILE_UPLOAD %}
        {# The basic File Upload plugin #}
        <script src="{{ STATIC_URL }}blueimp-file-upload/js/jquery.fileupload.js"></script>
    {% endblock %}

    {% block JS_JQUERY_FILE_UPLOAD_FP %}
        {# The File Upload file processing plugin #}
        <script src="{{ STATIC_URL }}blueimp-file-upload/js/jquery.fileupload-process.js"></script>
    {% endblock %}

    {% block JS_JQUERY_FILE_UPLOAD_IMAGE %}
        {# The File Upload image preview & resize plugin #}
        <script src="{{ STATIC_URL }}blueimp-file-upload/js/jquery.fileupload-image.js"></script>
    {% endblock %}

    {% block JS_JQUERY_FILE_UPLOAD_AUDIO %}
        {# The File Upload audio preview plugin #}
        <script src="{{ STATIC_URL }}blueimp-file-upload/js/jquery.fileupload-audio.js"></script>
    {% endblock %}

    {% block JS_JQUERY_FILE_UPLOAD_VIDEO %}
        {# The File Upload video preview plugin #}
        <script src="{{ STATIC_URL }}blueimp-file-upload/js/jquery.fileupload-video.js"></script>
    {% endblock %}

    {% block JS_JQUERY_FILE_UPLOAD_VALIDATE %}
        {# The File Upload validation plugin #}
        <script src="{{ STATIC_URL }}blueimp-file-upload/js/jquery.fileupload-validate.js"></script>
    {% endblock %}

    {% block JS_JQUERY_FILEUPLOAD_UI %}
        {# The File Upload user interface plugin #}
        <script src="{{ STATIC_URL }}blueimp-file-upload/js/jquery.fileupload-ui.js"></script>
    {% endblock %}

    {# The main application script #}

    <script type="text/javascript">
        $( function() {
            'use strict';

            {% comment %}
                Initialize the jQuery File Upload widget.

                Default options are defined by the package,
                however users may extend and define their
                own options.
            {% endcomment %}

            {% block JS_INIT %}

                {% comment %}
                    In order to support both CSRF tokens and extra form inputs,
                    the upload form (assumed to have an id of "fileupload") is serialized
                    to produce an array. This array is then updated with the csrf_token.

                    The contents of the array are then sent as form data to the upload
                    handling Django view.
                {% endcomment %}

                var formData = $('#fileupload').serializeArray();
                formData.push(
                    { name: "csrfmiddlewaretoken", value: "{{ csrf_token }}" }
                    );

                $('#fileupload').fileupload({
                    formData: formData,

                    {% block JS_OPTS %}
                        imageMaxWidth: 900,
                        imageMaxHeight: 900,
                        loadImageFileTypes: /^image\/(gif|jpeg|png|svg\+xml)$/,
                        sequentialUploads: true,
                        disableImageResize: /Android(?!.*Chrome)|Opera/
                            .test(window.navigator && navigator.userAgent),

                        imageCrop: false, // Force cropped images
                        acceptFileTypes: /(\.|\/)(png|gif|jpe?g)$/i,
                        messages: {
                                        acceptFileTypes: 'File type not allowed'
                                    },
                        imageOrientation: true
                    {% endblock %}
                });

                    {% block JS_CROSS_DOMAIN %}
                        // Enable iframe cross-domain access via redirect option:
                        //    $('#fileupload').fileupload(
                        //        'option',
                        //        'redirect',
                        //        window.location.href.replace(
                        //            /\/[^\/]*$/,
                        //            '/cors/result.html?%s'
                        //        )
                        //    );
                    {% endblock %}

                    {% block JS_LOAD_EXISTING_FILES %}
                        // Load existing files:
                        {% if uploaded_view_url %}
                            $('#fileupload').addClass('fileupload-processing');
                            $.ajax({
                                // Uncomment the following to send cross-domain cookies:
                                //xhrFields: {withCredentials: true},
                                //url: $('#fileupload').fileupload('option', 'url'),

                                url: "{{ uploaded_view_url }}",

                                dataType: 'json',
                                context: $('#fileupload')[0]
                            }).always(function () {
                                $(this).removeClass('fileupload-processing');
                                $(".fileupload-loading").remove();
                            }).done(function (result) {
                                $(this).fileupload('option', 'done')
                                    .call(this, $.Event('done'), {result: result});
                            });
                        {% endif %}
                    {% endblock %}
            {% endblock %}
        });
    </script>

    {% block JS_XDR_TRANSPORT %}
        {# The XDomainRequest Transport is included for cross-domain file deletion for IE8+ #}
        <!--[if gte IE 8]>
        <script src="{{ STATIC_URL }}blueimp-file-upload/js/cors/jquery.xdr-transport.js"></script>
        <![endif]-->
    {% endblock %}

    {% block JS_EXTRA %}
    {% endblock %}

{% endblock %}