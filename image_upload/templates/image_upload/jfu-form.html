{% load i18n %}
{% csrf_token %}
{# Redirect browsers with JavaScript disabled to the origin page #}
<noscript>
    <input type="hidden" name="redirect" value="{{ request.path }}"> </noscript>

{% if IS_COURSE_STAFF or MAY_CHANGE_ANSWER %}
{% block UPLOAD_FORM_BUTTON_BAR %}
    <div class="row fileupload-buttonbar">
        {# The fileupload-buttonbar contains buttons to add/delete files and start/cancel the upload #}

        <div class="col-lg-7 col-sm-6 col-xs-6 ">
            {# The fileinput-button span is used to style the file input field as button #}
            {% block UPLOAD_FORM_BUTTON_BAR_ADD %}
                <button class="btn btn-success fileinput-button btn-control">
                    <i class="glyphicon glyphicon-plus"></i>
                    <span>{% trans "Add files..." %}</span>
                    {% block UPLOAD_FORM_BUTTON_BAR_ADD_FILE_INPUT %}
                        {% comment %}
                            UPLOAD_FORM_BUTTON_BAR_ADD_FILE_INPUT and FILE_INPUT
                            control the same block. 

                            FILE_INPUT is the original and shorter block name that has
                            been kept to function as a convenient alias as well as to
                            allow backward-compatibility with dependent projects. 

                            Note: Only one should be overriden in the inheriting templates.
                        {% endcomment %}
                            {% block FILE_INPUT %}
                                {# The file input for the upload form. #}
                                <input type="file" name="image" multiple
                                    {% if accepted_mime_types %}
                                        accept='{{ accepted_mime_types|join:", " }} capture=camera'
                                    {% endif %}
                                >
                            {% endblock %}{# //FILE_INPUT #}
                    {% endblock %}{# //block UPLOAD_FORM_BUTTON_BAR_ADD_FILE_INPUT #}

                </button>

                {% block UPLOAD_FORM_BUTTON_BAR_ADD_EXTRA %}
                {% endblock %}{# //UPLOAD_FORM_BUTTON_BAR_ADD_EXTRA #}
            {% endblock %}{# //block UPLOAD_FORM_BUTTON_BAR_ADD #}

            {% block UPLOAD_FORM_BUTTON_BAR_CONTROL %}
                <button type="submit" class="btn btn-primary start btn-control" disabled>
                    <i class="glyphicon glyphicon-upload" disabled></i>
                    <span>{% trans "Start upload" %}</span>
                </button>
                <button type="reset" class="btn btn-warning cancel btn-control" disabled>
                    <i class="glyphicon glyphicon-ban-circle"></i>
                    <span>{% trans "Cancel upload" %}</span>
                </button>
                <button type="button" class="btn btn-danger delete btn-control" disabled>
                    <i class="glyphicon glyphicon-trash"></i>
                    <span>{% trans "Delete" %}</span>
                </button>
                <input type="checkbox" class="toggle hidden-sm hidden-xs">
            {% endblock %}{# //UPLOAD_FORM_BUTTON_BAR_CONTROL #}
            {% block UPLOAD_FORM_BUTTON_BAR_EXTRA %}
            {% endblock %}{# //UPLOAD_FORM_BUTTON_BAR_EXTRA #}

        </div>

        {% block UPLOAD_FORM_PROGRESS_BAR %}
            {# The global progress information #}
            <div class="col-lg-5 col-sm-6 col-xs-6 fileupload-progress fade">
                {# The global progress bar #}
                    <div
                        class="progress progress-striped active"
                        role="progressbar"
                        aria-valuemin="0" aria-valuemax="100"
                    >
                    <div class="progress-bar progress-bar-success" style="width:0%;">
                </div>
                </div>
                {# The extended global progress information #}
                <div class="progress-extended">&nbsp;</div>
            </div>
        {% endblock %}
    </div>
{% endblock %}{# //UPLOAD_FORM_BUTTON_BAR #}
{% endif %}

{# The loading indicator is shown during file processing #}
{% block UPLOAD_FORM_LINDICATOR %}
    <div class="fileupload-loading"></div>
{% endblock %}{# //UPLOAD_FORM_LINDICATOR #}

{% block UPLOAD_FORM_LISTING %}
    {# The table listing the files available for upload/download #}
    <table role="presentation" class="table table-striped" id="img-presentation-table">
        <tbody class="files"></tbody>
    </table>
    <div class="fileupload-download-processing"></div>
{% endblock %}{# //UPLOAD_FORM_LISTING #}

{% block UPLOAD_FORM_EXTRA %} {% endblock %}

{% block JS_UPLOAD_TEMPLATE %}
    <script id="template-upload" type="text/x-tmpl">
        {{ JQ_OPEN }} for (var i=0, file; file=o.files[i]; i++) { {{ JQ_CLOSE }}

            <tr class="template-upload fade">

                {% block JS_UPLOAD_TEMPLATE_PREVIEW %}
                    <td>
                        <span class="preview"></span>
                    </td>
                {% endblock %}{# // JS_UPLOAD_TEMPLATE_PREVIEW #}

                {% block JS_UPLOAD_TEMPLATE_UPLOAD %}
                    <td>
                        <p class="name">{{ JQ_OPEN }}=file.name{{ JQ_CLOSE }}</p>
                        <p class="size hidden-lg hidden-md">Processing...</p>
                        <div class="progress progress-striped active hidden-lg hidden-md" role="progressbar"
                            aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                            <div class="progress-bar progress-bar-success hidden-lg hidden-md" style="width:0%;"></div>
                        </div>
                        <strong class="error text-danger"></strong>
                    </td>
                {% endblock %}{# //JS_UPLOAD_TEMPLATE_UPLOAD #}

                {% block JS_UPLOAD_TEMPLATE_PROGRESSBAR %}
                    <td class="hidden-sm hidden-xs">
                        <p class="size">{% trans "Processing" %}...</p>
                        <div class="progress progress-striped active" role="progressbar"
                            aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                            <div class="progress-bar progress-bar-success" style="width:0%;"></div>
                        </div>
                    </td>
                {% endblock %}{# //JS_UPLOAD_TEMPLATE_PROGRESSBAR #}

                {% block JS_UPLOAD_TEMPLATE_CONTROLS %}
                    <td>
                        {% block JS_UPLOAD_TEMPLATE_START %}
                            {{ JQ_OPEN }} if (!i && !o.options.autoUpload) { {{ JQ_CLOSE }}
                                <button class="btn btn-primary start" disabled>
                                    <i class="glyphicon glyphicon-upload"></i>
                                    <span>{% trans "Start" %}</span>
                                </button>
                            {{ JQ_OPEN }} } {{ JQ_CLOSE }}
                        {% endblock %}{# //block JS_UPLOAD_TEMPLATE_START #}

                        {% block JS_UPLOAD_TEMPLATE_CANCEL %}
                            {{ JQ_OPEN }} if (!i) { {{ JQ_CLOSE }}
                                <button class="btn btn-warning cancel">
                                    <i class="glyphicon glyphicon-ban-circle"></i>
                                    <span>{% trans "Cancel" %}</span>
                                </button>
                            {{ JQ_OPEN }} } {{ JQ_CLOSE }}
                        {% endblock %}{# //JS_UPLOAD_TEMPLATE_CANCEL #}
                    </td>
                {% endblock %}{# //JS_UPLOAD_TEMPLATE_CONTROLS #}

            </tr>

        {{ JQ_OPEN }} } {{ JQ_CLOSE }}
    </script>
{% endblock %}{# //JS_UPLOAD_TEMPLATE #}


{% block JS_DOWNLOAD_TEMPLATE %}
    {# The template to display files available for download #}
    <script id="template-download" type="text/x-tmpl">
        {{ JQ_OPEN }} for (var i=0, file; file=o.files[i]; i++) { {{ JQ_CLOSE }}

            <tr class="template-download fade"
                data-file-pk="{{ JQ_OPEN }}=file.pk{{ JQ_CLOSE }}"
                >
                {% block JS_DOWNLOAD_TEMPLATE_PREVIEW %}
                    <td class="col-lg-2 col-sm-3 col-xs-3">
                        <span class="preview processing">
                            {{ JQ_OPEN }} if (file.thumbnailUrl) { {{ JQ_CLOSE }}
                                <a
                                    href="{{ JQ_OPEN }}=file.url{{ JQ_CLOSE }}"
                                    title="{{ JQ_OPEN }}=file.name{{ JQ_CLOSE }}"
                                    download="{{ JQ_OPEN }}=file.name{{ JQ_CLOSE }}"
                                    id="previewid{{ JQ_OPEN }}=file.pk{{ JQ_CLOSE }}"
                                    data-gallery>
                                    <img class="img-responsive"
                                       id="thumbnail{{ JQ_OPEN }}=file.pk{{ JQ_CLOSE }}"
                                       {% if IN_GRADE_PAGE %}
                                        src="{{ JQ_OPEN }}=file.url{{ JQ_CLOSE }}"
                                        onload="enableMagnify(this, '{{ JQ_OPEN }}=file.url{{ JQ_CLOSE }}')"
                                        {% else %}
                                        src="{{ JQ_OPEN }}=file.thumbnailUrl{{ JQ_CLOSE }}"
                                        onload="hideLoading(this)"
                                        {% endif %}
                                    >
                                </a>
                            {{ JQ_OPEN }} } {{ JQ_CLOSE }}
                        </span>
                    </td>
                {% endblock %}{# //JS_DOWNLOAD_TEMPLATE_PREVIEW #}

                {% block JS_DOWNLOAD_TEMPLATE_DOWNLOAD %}
                    <td class="col-lg-2 hidden-sm hidden-xs grading-hidden">
                        <p class="name">
                            {{ JQ_OPEN }} if (file.url) { {{ JQ_CLOSE }}
                                <a 
                                    href="{{ JQ_OPEN }}=file.url{{ JQ_CLOSE }}"
                                    title="{{ JQ_OPEN }}=file.name{{ JQ_CLOSE }}"
                                    download="{{ JQ_OPEN }}=file.name{{ JQ_CLOSE }}"
                                    {{ JQ_OPEN }}=file.url? 'data-gallery': ''{{ JQ_CLOSE }}
                                    id="filename{{ JQ_OPEN }}=file.pk{{ JQ_CLOSE }}"
                                >
                                    {{ JQ_OPEN }}=file.name_trancated{{ JQ_CLOSE }}
                                </a>
                            {{ JQ_OPEN }} } else { {{ JQ_CLOSE }}
                                <span>
                                    {{ JQ_OPEN }}=file.name_trancated{{ JQ_CLOSE }}
                                </span>
                            {{ JQ_OPEN }} } {{ JQ_CLOSE }}
                        </p>

                        {% block JS_DOWNLOAD_TEMPLATE_ERROR %}
                            {{ JQ_OPEN }} if (file.error) { {{ JQ_CLOSE }}
                                <div>
                                    <span
                                        class="label label-danger"
                                    >
                                        {% trans "Error" %}
                                    </span>
                                    {{ JQ_OPEN }}=file.error{{ JQ_CLOSE }}
                                </div>
                            {{ JQ_OPEN }} } {{ JQ_CLOSE }}
                        {% endblock %}{# //block JS_DOWNLOAD_TEMPLATE_ERROR #}
                    </td>
                    <td class="hidden-lg hidden-md fileUploadCompactInfo grading-hidden">
                        <p style="width: 30vw;">{{ JQ_OPEN }}=file.name_trancated{{ JQ_CLOSE }}
                                <span onclick="$('#moreinfo{{ JQ_OPEN }}=file.pk{{ JQ_CLOSE }}').toggle(); return false;">...</span></p>
                            <div style="display: none;" id="moreinfo{{ JQ_OPEN }}=file.pk{{ JQ_CLOSE }}">
                                <p style="width: 30vw;">{{ JQ_OPEN }}=file.timestr_short{{ JQ_CLOSE }}</p><p style="width: 30vw;">{{ JQ_OPEN }}=o.formatFileSize(file.size){{ JQ_CLOSE }}</p>
                            </div>
                    </td>

                {% endblock %}{# block JS_DOWNLOAD_TEMPLATE_DOWNLOAD #}

                {% if SHOW_CREATION_TIME %}
{#                    {% if not IN_GRADE_PAGE %}#}
                    {% block JS_DOWNLOAD_TEMPLATE_TIME %}
                        <td class="col-lg-3 hidden-sm hidden-xs td-dl grading-hidden">
                            <span
                                class="timestr"
                                id="filetime{{ JQ_OPEN }}=file.pk{{ JQ_CLOSE }}"
                                title="{{ JQ_OPEN }}=file.timestr_title{{ JQ_CLOSE }}"
                            >
                                {{ JQ_OPEN }}=file.timestr_short{{ JQ_CLOSE }}
                            </span>
                        </td>
                    {% endblock %}{# block JS_DOWNLOAD_TEMPLATE_TIME #}
{#                    {% endif %}#}
                    {% endif %}

                {% block JS_DOWNLOAD_TEMPLATE_FSIZE %}
{#                    {% if not IN_GRADE_PAGE %}#}
                    <td class="col-lg-1 hidden-sm hidden-xs td-dl grading-hidden">
                        <span
                            class="size"
                            id="filesize{{ JQ_OPEN }}=file.pk{{ JQ_CLOSE }}"
                        >{{ JQ_OPEN }}=o.formatFileSize(file.size){{ JQ_CLOSE }}</span>
                    </td>
{#                    {% endif %}#}
                {% endblock %}{# //JS_DOWNLOAD_TEMPLATE_FSIZE #}

                <td class="td-dl col-lg-3 col-sm-4 col-xs-4">
                        {{ JQ_OPEN }} if (file.deleteUrl) { {{ JQ_CLOSE }}
                        {% if IS_COURSE_STAFF or MAY_CHANGE_ANSWER %}
                        {% block JS_DOWNLOAD_TEMPLATE_EDIT %}
                            {% if IS_COURSE_STAFF and SHOW_COPY_IMAGE_DATA %}
                                {% block COPY_IMAGE_DATA %}
                                {# 只有在设计问题时才有用 #}
                                {{ JQ_OPEN }} if (file.image_data_dict) { {{ JQ_CLOSE }}
                                        <a
                                            class="btn-data-copy"
                                            data-clipboard-text="{{ JQ_OPEN }}=file.image_data_dict{{ JQ_CLOSE }}"
                                        >
                                            <i class="fa fa-clipboard" aria-hidden="true"></i></a>
                                {{ JQ_OPEN }} } {{ JQ_CLOSE }}
                                {{ JQ_OPEN }} if (file.imageAdminUrl) { {{ JQ_CLOSE }}
                                        <a
                                            href={{ JQ_OPEN }}=file.imageAdminUrl{{ JQ_CLOSE }}
                                            target='_blank'
                                        >
                                            <i class="fa fa-user"></i></a>
                                {{ JQ_OPEN }} } {{ JQ_CLOSE }}
                                {% endblock %}{# block COPY_IMAGE_DATA #}
                            {% endif %}
                            <a
                                class="btn btn-success btn-edit-image btn-control"
                                data-toggle="modal"
                                data-action="{{ JQ_OPEN }}=file.crop_handler_url{{ JQ_CLOSE }}"
                                data-src="{{ JQ_OPEN }}=file.url{{ JQ_CLOSE }}"
                                data-pk="{{ JQ_OPEN }}=file.pk{{ JQ_CLOSE }}"
                                data-data="{{ csrf_token }}"
                                data-target="#editPopup"
                            >
                                <i class="fa fa-pencil"></i>
                                <span>{% trans "Edit" %}</span>
                            </a>
                        {% endblock %}{# //block JS_DOWNLOAD_TEMPLATE_EDIT #}
                        {% endif %}
                        {% block JS_DOWNLOAD_TEMPLATE_DELETE %}
                            <button
                                class="btn btn-danger delete btn-control"
                                id="deleteurl{{ JQ_OPEN }}=file.pk{{ JQ_CLOSE }}"
                                data-type="{{ JQ_OPEN }}=file.deleteType{{ JQ_CLOSE }}"
                                data-data='{ "csrfmiddlewaretoken" : "{{ csrf_token }}" }'
                                data-url="{{ JQ_OPEN }}=file.deleteUrl{{ JQ_CLOSE }}"
                                {{ JQ_OPEN }} if (file.deleteWithCredentials) { {{ JQ_CLOSE }}
                                    data-xhr-fields='{"withCredentials":true}'
                                {{ JQ_OPEN }} } {{ JQ_CLOSE }}
                            >
                                <i class="glyphicon glyphicon-trash"></i>
                                <span>{% trans "Delete" %}</span>
                            </button>
                            <input type="checkbox" name="delete" value="1" class="toggle">
                        {{ JQ_OPEN }} } else { {{ JQ_CLOSE }}
                            <button class="btn btn-warning cancel">
                                <i class="glyphicon glyphicon-ban-circle"></i>
                                <span>{% trans "Cancel" %}</span>
                            </button>
                        {% endblock %}{# //block JS_DOWNLOAD_TEMPLATE_DELETE #}
                        {{ JQ_OPEN }} } {{ JQ_CLOSE }}
                </td>
                {% if IS_COURSE_STAFF or MAY_CHANGE_ANSWER %}
                <td class="imageSortableHandle col-lg-2 col-sm-1 col-xs-1 hidden" style=" vertical-align: middle;"><span title="{% trans 'Drag to order' %}"><i class="fa fa-sort fa-3" aria-hidden="true"></i></span></td>
                {% endif %}
            </tr>
        {{ JQ_OPEN }} } {{ JQ_CLOSE }}
    </script>

{% endblock %}