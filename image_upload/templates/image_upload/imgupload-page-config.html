{% extends 'image_upload/upload_form.html' %}
{% load i18n %}
{% load static %}

{% block CSS_BOOTSTRAP %}{# BOOTSTRAP css (Override to keep it empty) #}{% endblock %}
{% block JS_JQUERY %}{#jQuery (Override to keep it empty) {% endcomment #}{% endblock %}
{% block CSS_HTML5_SHIM %}{# IE 9 lt already supported (Override to keep it empty)#}{% endblock %}

{% block CSS_EXTRA %}
{% if not IN_GRADE_PAGE %}
{{ block.super }}
{% else %}
<style>

.grading-hidden {
    display: none;
    padding: 0;
}

@media (min-width: 767px) {
    .preview img {
        max-width: 100%;
    }
}
@media (max-width: 767px) {
    .grading-page-student-work.container > div > div{
       padding: 0;
   }
    h1, h2, h3, p {overflow-wrap: break-word;}
    .preview img {
        max-width: calc(100% + 54px);
    }
    .fileupload-buttonbar .delete
    {
        display: none;
    }
}
</style>
{% endif %}
<link rel="stylesheet" href="{% static "css/imgupload-page.css"  %}?rev=2.2.1 ">
<link rel="stylesheet" href="{% static "cropperjs/dist/cropper.css" %} ">
<noscript><link rel="stylesheet" href="{% static "css/imgupload-noscript.css" %} "></noscript>
    <!--[if lt IE 9]>
        <link rel="stylesheet" href="{% static "css/imgupload-noscript.css" %} ">
    <![endif]-->
{% endblock %}

{% block JS_BOOTSTRAP %}{# BOOTSTRAP js (Override to keep it empty) #}{% endblock %}

{% block UPLOAD_FORM %}
    <noscript><div class="alert alert-danger warning noscript"><i class="fa fa-warning"></i> {% trans "This page requires Javascript enabled in your browser. Please refer to <a href='https://www.whatismybrowser.com/guides/how-to-enable-javascript/' target='_blank'> this link </a> to see how to do it." %}<br/></div></noscript>
    <!--[if lte IE 9]>
        <div class="browser alert alert-danger warning"><i class="fa fa-warning"></i> {% trans "This page requires a modern browser so that it can work properly" %}, {% trans "especially when you want to sort image correctly and enable image editting" %}. {% trans "Chrome/Firefox are prefered browsers. If you want use Internet Explorer, please install one with version higher than 10." %}<br/></div>
    <![endif]-->
{% load i18n crispy_forms_tags %}
{% crispy form %}
{% endblock %}

{% block JS_OPTS %}
imageMaxWidth: {{imageMaxWidth}},
imageMaxHeight: {{imageMaxHeight}},
loadImageFileTypes: /^image\/(gif|jpeg|png|svg\+xml)$/,
sequentialUploads: true,
disableImageResize: /Android(?!.*Chrome)|Opera/
    .test(window.navigator && navigator.userAgent),

imageCrop: false, // Force cropped images
acceptFileTypes: /(\.|\/)(png|gif|jpe?g)$/i,
messages: {
            maxFileSize: '{% trans "File is too big" %}',
            minFileSize: '{% trans "File is too small" %}',
            acceptFileTypes: '{% trans "Filetype not allowed" %}',
            maxNumberOfFiles: '{% blocktrans trimmed %} Max number of files exceeded, only {{maxNumberOfFiles}} allowed{% endblocktrans %}',
            uploadedBytes: '{% trans "Uploaded bytes exceed file size" %}',
            emptyResult: '{% trans "Empty file upload result" %}'
            },
imageOrientation: true,
maxNumberOfFiles: {{maxNumberOfFiles}},
previewMaxWidth: {{previewMaxWidth}},
previewMaxHeight: {{previewMaxHeight}},
maxFileSize: {{maxFileSize}},
minFileSize: {{minFileSize}},
{% endblock %}


{% block JS_EXTRA %}
{{ block.super }}
<script src="{% static "clipboard/dist/clipboard.min.js" %} "></script>
<script src="{% url 'javascript-catalog-image-upload'  %}?rev=1.0.1"></script>
<script src="{% static "cropperjs/dist/cropper.js" %} "></script>
<script src="{% static "js/imgupload-page.js" %}?rev=2.2.1 "></script>
{# % if IN_GRADE_PAGE % #}
<script src="{% static "ez-plus/src/jquery.ez-plus.js" %} "></script>
<script>

$(document).ready(function () {
    var pre = $('.latexpage-error pre'),
            pl = pre.length;
    for (var i = 0; i < pl; i++) {
        pre[i].innerHTML = '<span class="line-number"></span>' + pre[i].innerHTML + '<span class="cl"></span>';
        var num = pre[i].innerHTML.split(/\n/).length;
        for (var j = 0; j < num; j++) {
            var line_num = pre[i].getElementsByTagName('span')[0];
            line_num.innerHTML += '<span>' + (j + 1) + '</span>';
        }
    }
});

function hideLoading(that){
    $(".fileupload-download-processing").remove();
    $(that).parents("span").removeClass("processing");
}

function magnify(that) {
    $(that).ezPlus({
    zoomType: 'inner',
    cursor: 'crosshair'
});
}
</script>
{# % endif % #}
{% endblock %}

{% block JS_UPLOAD_TEMPLATE %}{% endblock %}
{% block JS_DOWNLOAD_TEMPLATE %}{% endblock %}

{% block JS_LOAD_EXISTING_FILES %}
    // Load existing files:
    {% if uploaded_view_url %}
        $('#fileupload').addClass('fileupload-processing');
        $.ajax({
            // Uncomment the following to send cross-domain cookies:
            //xhrFields: {withCredentials: true},
            //url: $('#fileupload').fileupload('option', 'url'),

            url: "{{ uploaded_view_url }}",

            dataType: 'json',
            context: $('#fileupload')[0]
        }).always(function () {
            $(this).removeClass('fileupload-processing');
        }).done(function (result) {
            $(this).fileupload('option', 'done')
                .call(this, $.Event('done'), {result: result});
            console.log("finish loading existing files in jfu");
            console.log(Date.now()/1000);
        });
    {% endif %}
{% endblock %}
